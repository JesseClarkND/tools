using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ElDorado.Utility
{
    public class PortList
    {
        //https://github.com/PhilipMur/C-Sharp-Multi-Threaded-Port-Scanner/blob/master/MultiPortScan/PortList.cs
        private int _start;
        private int _stop;
        private int _ports;
        private bool _popularMode = false;
        private readonly object _lockList = new object();

        //http://packetlife.net/media/library/23/common-ports.pdf
        private static List<int> _popularPorts = new List<int>()
        {
            7, 19, 20, 21,22,23,25,42,43,49,53,67,68,69,70,79,80,88,102,110,113,119,123,135,137,138,139,143,161,162,177,179,201,264,381,382,383,389,411,412,443,445,464,465,497,500,512,513,514,515,520,521,540,
            554, 546,547,560,563,587,591,593,631,636,639,646,691,860,873,902,989,990,993,995,1025,1026,1027,1028,1029,1080,1194,1214,1241,1311,1337,1433,1434,1512,1589,1701,1723,17251741,1755,1812,1813,1863,1985,2000,2002,2049,2082,2083,2100,2222,2302,2483,2484,
            2745,2967,3050,3074,3124,3127,3128,3222,3260,3306,3389,3689,3690,3724,3784,3785,4333,4444,4664,4672,4899,5000,5001,5004,5005,5050,5060,5190,5222,5223,5432,5500,5554,5631,5632,5800,5900,6000,6001,6112,6129,6257,6346,6347,6500,6566,6588,6665,6666,6667,6668,6669,6679,6697,6699,6881,6882,6883,6884,6885,6886,6887,6888,6889,6890,6891,6892,6893,6894,6895,6896,6897,6898,6899,6900,6901,6902,6903,6904,6905,6906,6907,6908,6909,6910,6911,6912,6913,6914,6915,6916,6917,6918,6919,6920,6921,6922,6923,6924,6925,6926,6927,6928,6929,6930,6931,6932,6933,6934,6935,6936,6937,6938,6939,6940,6941,6942,6943,6944,6945,6946,6947,6948,6949,6950,6951,6952,6953,6954,6955,6956,6957,6958,6959,6960,6961,6962,6963,6964,6965,6966,6967,6968,6969,6970,6971,6972,6973,6974,6975,6976,6977,6978,6979,6980,6981,6982,6983,6984,6985,6986,6987,6988,6989,6990,6991,6992,6993,6994,6995,6996,6997,6998,6999,
            6970,7212,7648,7649,8000,8080,8086,8087,8118,8200,8500,8767,8866,9100,9101,9103,9119,9800,9898,9988,9999,10000,10113,10114,10115,10116,11371,12035,12036,12345,13720,13721,14567,15118,19226,19638,20000,24800,25999,27015,27374,28960,31337,33434
        };

        public PortList()
        {
            _popularMode = true;
            _ports = -1;
        }

        public PortList(int starts, int stops)
        {
            _start = starts;
            _stop = stops;
            _ports = _start;
        }

        public bool MorePorts()
        {
            return (_stop - _ports) >= 0;
        }

        public int NextPort()
        {
            if (_popularMode)
            {
                lock (_lockList)
                {
                    _ports++;
                    if (_ports < _popularPorts.Count)
                        return _popularPorts[_ports];
                }
            }
            else
            {
                lock (_lockList)
                {
                    if (MorePorts())
                    {
                        return _ports++;
                    }
                }
            }
            return -1;
        }
    }
}